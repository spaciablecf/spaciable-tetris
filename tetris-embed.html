<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Spaciable Tetris</title>
  <style>
    :root{
      --primary:#f80954;          /* accent */
      --bg:#0d2b3f;               /* page + panels */
      --text:#ffffff;             /* text */
      --border:rgba(255,255,255,.15);
      --cell:rgba(255,255,255,.03);
      --cellBorder:rgba(255,255,255,.10);
      --ghost:rgba(255,255,255,.18);
      --bgImage:url('https://images.squarespace-cdn.com/content/64edc4eea3459328995c51ca/6869a435-3686-45aa-807d-a1df215bcacd/Untitled+design+-+2025-09-30T110233.088.png?content-type=image%2Fpng');
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font:14px system-ui,Segoe UI,Roboto,Arial}
    .wrap{min-height:100vh;display:flex;justify-content:center;padding:16px}
    .grid{display:grid;gap:16px;grid-template-columns:1fr auto 320px;max-width:1100px;width:100%}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:#0d2b3f;border:1px solid var(--border);border-radius:16px;padding:16px}
    .title{font-weight:800;letter-spacing:.2px;font-size:22px;margin:0 0 8px}
    .row{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .label{font-size:12px;color:rgba(255,255,255,.7)}
    .val{font-size:18px;font-weight:800}
    .controls input[type="number"]{width:100%;padding:10px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.08);color:#fff;outline:0}
    .btn{padding:10px 14px;border-radius:14px;border:0;cursor:pointer;font-weight:700}
    .btn-start{background:var(--primary);color:#fff}
    .btn-pause{background:#ffffff;color:#0d2b3f}
    .btn-reset{background:rgba(255,255,255,.12);color:#fff}
    .stats{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .stat{background:rgba(255,255,255,.06);border:1px solid var(--border);border-radius:14px;padding:12px}
    .kbd{background:rgba(255,255,255,.1);border:1px solid var(--border);border-radius:6px;padding:2px 6px}
    .lb-list{margin:8px 0 0;padding:0;list-style:none}
    .lb-list li{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed rgba(255,255,255,.15)}
    .hint{color:rgba(255,255,255,.75);font-size:12px}

    .boardWrap{display:flex;justify-content:center}
    .board{position:relative;background:#0b1f2c;border:1px solid var(--border);border-radius:16px;padding:6px;overflow:hidden}
    .board::before{
      content:"";position:absolute;inset:6px;background-image:var(--bgImage);
      background-size:cover;background-position:center;opacity:.40;border-radius:12px;z-index:0;pointer-events:none
    }
    .cells{position:relative;z-index:1;display:grid;gap:2px}
    .cell{width:26px;height:26px;background:var(--cell);border:1px solid var(--cellBorder);border-radius:4px;box-shadow:inset 0 0 6px rgba(0,0,0,.25)}
    .rightCol{display:flex;flex-direction:column;gap:16px}
  </style>
</head>
<body>
<div class="wrap">
  <div class="grid">
    <div class="card controls">
      <h2 class="title">Spaciable Tetris</h2>
      <p class="hint">Time limit, custom starting speed, optional fixed speed, and a local leaderboard.</p>

      <div class="row" style="margin-top:8px">
        <div><div class="label">Minutes</div><input id="minInput" type="number" min="0" max="59" value="2"></div>
        <div><div class="label">Seconds</div><input id="secInput" type="number" min="0" max="59" value="0"></div>
        <div><div class="label">Start Speed (Level)</div><input id="spdInput" type="number" min="1" max="20" value="1"></div>

        <div style="grid-column:1/-1;display:flex;align-items:center;gap:8px;margin-top:4px">
          <input id="fixedChk" type="checkbox"><label for="fixedChk" class="hint"> Keep speed fixed</label>
        </div>

        <div style="grid-column:1/-1;display:flex;gap:8px">
          <button id="startBtn" class="btn btn-start" style="flex:1">Start</button>
          <button id="pauseBtn" class="btn btn-pause" style="flex:1">Pause</button>
          <button id="resetBtn" class="btn btn-reset">Reset</button>
        </div>
      </div>

      <div class="stats" style="margin-top:12px">
        <div class="stat"><div class="label">Score</div><div id="scoreVal" class="val">0</div></div>
        <div class="stat"><div class="label">Lines</div><div id="linesVal" class="val">0</div></div>
        <div class="stat"><div class="label">Level</div><div id="levelVal" class="val">1</div></div>
        <div class="stat"><div class="label">Time</div><div id="timeVal" class="val">02:00</div></div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="label" style="margin-bottom:6px">Controls</div>
        <div class="hint">←/→ move • ↑ rotate • ↓ soft drop • <span class="kbd">Space</span> hard drop • <span class="kbd">P</span> pause • <span class="kbd">R</span> reset</div>
      </div>
    </div>

    <div class="boardWrap"><div class="board"><div id="board" class="cells"></div></div></div>

    <div class="rightCol">
      <div class="card"><div class="label" style="margin-bottom:8px">Next</div><div id="nextWrap" style="display:grid;gap:8px"></div></div>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="label">Leaderboard (this browser)</div>
          <button id="clearLb" class="btn btn-reset" style="padding:6px 10px">Reset LB</button>
        </div>
        <ol id="lb" class="lb-list"></ol>
      </div>
    </div>
  </div>
</div>

<div id="nameModal" class="modal"><div class="dialog">
  <h3 style="margin:0 0 8px;font-weight:800;color:#fff">Time’s up!</h3>
  <p class="hint" style="margin:0 0 12px">Enter your name to save your score.</p>
  <input id="nameInput" placeholder="Your name"/>
  <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
    <button id="skipBtn" class="btn btn-reset">Skip</button>
    <button id="saveBtn" class="btn btn-start">Save</button>
  </div>
</div></div>

<script>
(function(){
  const COLS=10, ROWS=20, CELL=26;
  const SCORE_TABLE={1:100,2:300,3:500,4:800};
  const STORAGE_LB='custom-tetris-leaderboard';
  /* FIXED: the S piece now has its colon */
  const SHAPES={
    I:[[0,0,0,0],[1,1,1,1]],
    J:[[1,0,0],[1,1,1]],
    L:[[0,0,1],[1,1,1]],
    O:[[1,1],[1,1]],
    S:[[0,1,1],[1,1,0]],
    T:[[0,1,0],[1,1,1]],
    Z:[[1,1,0],[0,1,1]]
  };
  const COLORS={I:'#22d3ee',J:'#3b82f6',L:'#f59e0b',O:'#fde047',S:'#34d399',T:'#a855f7',Z:'#f43f5e'};

  const $=id=>document.getElementById(id);
  const boardEl=$('board'), nextWrap=$('nextWrap'), lbEl=$('lb');
  const scoreVal=$('scoreVal'), linesVal=$('linesVal'), levelVal=$('levelVal'), timeVal=$('timeVal');
  const minInput=$('minInput'), secInput=$('secInput'), spdInput=$('spdInput'), fixedChk=$('fixedChk');
  const startBtn=$('startBtn'), pauseBtn=$('pauseBtn'), resetBtn=$('resetBtn');
  const nameModal=$('nameModal'), nameInput=$('nameInput'), skipBtn=$('skipBtn'), saveBtn=$('saveBtn'), clearLb=$('clearLb');

  let board,queue,current,score,lines,level,dropInterval,gravTimer,tickTimer,running,paused,totalSeconds,remaining,startSpeed,fixedSpeed;

  function empty(){return Array.from({length:ROWS},()=>Array(COLS).fill(null))}
  const clone=b=>b.map(r=>r.slice());
  function randomBag(){return ['I','J','L','O','S','T','Z'].sort(()=>Math.random()-.5)}
  function piece(t){const s=SHAPES[t].map(r=>r.slice());return {type:t,shape:s,x:3,y:-2}}
  function collide(b,p,dx=0,dy=0){
    for(let r=0;r<p.shape.length;r++){
      for(let c=0;c<p.shape[r].length;c++){
        if(p.shape[r][c]){
          const nx=p.x+c+dx, ny=p.y+r+dy;
          if(nx<0||nx>=COLS||ny>=ROWS) return true;
          if(ny>=0&&b[ny][nx]) return true;
        }
      }
    }
    return false;
  }
  function merge(b,p){const nb=clone(b);p.shape.forEach((row,r)=>row.forEach((v,c)=>{if(v&&p.y+r>=0)nb[p.y+r][p.x+c]=p.type}));return nb}
  function clearLines(b){const nb=[];let cl=0;for(let r=0;r<ROWS;r++){if(b[r].every(v=>v))cl++;else nb.push(b[r])}while(nb.length<ROWS)nb.unshift(Array(COLS).fill(null));return{board:nb,cleared:cl}}
  function rot(s){return s[0].map((_,c)=>s.map(row=>row[c]).reverse())}
  function buildBoard(){boardEl.style.display='grid';boardEl.style.gap='2px';boardEl.style.gridTemplateColumns=`repeat(${COLS},${CELL}px)`;boardEl.innerHTML='';for(let i=0;i<COLS*ROWS;i++){const d=document.createElement('div');d.className='cell';boardEl.appendChild(d)}}
  function draw(){
    const cells=boardEl.children, temp=clone(board);
    if(current){
      for(let r=0;r<current.shape.length;r++)
        for(let c=0;c<current.shape[r].length;c++)
          if(current.shape[r][c]){
            const ny=current.y+r, nx=current.x+c;
            if(ny>=0) temp[ny][nx]=current.type;
          }
    }
    let k=0;
    for(let r=0;r<ROWS;r++)
      for(let c=0;c<COLS;c++){
        const cell=cells[k++], v=temp[r][c];
        cell.style.background = v ? COLORS[v] : 'var(--cell)';
        cell.style.borderColor = v ? 'rgba(0,0,0,.25)' : 'var(--cellBorder)';
      }
    scoreVal.textContent=score; linesVal.textContent=lines; levelVal.textContent=level;
    timeVal.textContent = String(Math.floor(remaining/60)).padStart(2,'0')+':'+String(remaining%60).padStart(2,'0');
  }
  function drawNext(){
    nextWrap.innerHTML='';
    queue.slice(0,5).forEach(t=>{
      const shape=SHAPES[t], scale=14, mini=document.createElement('div');
      mini.style.display='grid'; mini.style.gap='2px';
      mini.style.gridTemplateColumns=`repeat(${shape[0].length}, ${scale}px)`;
      shape.flat().forEach(v=>{
        const d=document.createElement('div');
        d.style.width=scale+'px'; d.style.height=scale+'px'; d.style.borderRadius='4px';
        d.style.background = v ? COLORS[t] : 'rgba(255,255,255,.12)';
        mini.appendChild(d);
      });
      const box=document.createElement('div'); box.className='card'; box.style.padding='8px'; box.appendChild(mini); nextWrap.appendChild(box);
    });
  }
  function refill(){if(queue.length<7) queue=queue.concat(randomBag())}
  function spawn(){refill();current=piece(queue.shift());drawNext();if(collide(board,current)) endGame()}
  function levelInterval(l){return Math.max(120,800-(l-1)*60)}
  function startGame(){
    if(running) return;
    const m=parseInt(minInput.value||0,10), s=parseInt(secInput.value||0,10);
    startSpeed=parseInt(spdInput.value||1,10); fixedSpeed=!!fixedChk.checked;
    totalSeconds=m*60+s; remaining=totalSeconds||120;
    board=empty(); queue=randomBag(); current=null;
    score=0; lines=0; level=startSpeed; dropInterval=levelInterval(level);
    paused=false; running=true; spawn(); draw();
    if(gravTimer) clearInterval(gravTimer);
    gravTimer=setInterval(()=>{ if(!paused && running) softDrop(); }, dropInterval);
    if(tickTimer) clearInterval(tickTimer);
    tickTimer=setInterval(()=>{ if(!running||paused) return; remaining--; if(remaining<=0){remaining=0; endGame();} draw(); },1000);
  }
  function endGame(){running=false; paused=false; clearInterval(gravTimer); clearInterval(tickTimer); nameModal.classList.add('open')}
  function pauseResume(){ if(running) paused=!paused; }
  function resetGame(){running=false; clearInterval(gravTimer); clearInterval(tickTimer); board=empty(); queue=[]; current=null; score=0; lines=0; level=1; remaining=totalSeconds; draw(); drawNext();}
  function tryMove(dx,dy){ if(current && !collide(board,current,dx,dy)){ current.x+=dx; current.y+=dy; draw(); } }
  function rotatePiece(){ if(current){ const t={...current,shape:rot(current.shape)}; if(!collide(board,t)) current=t; draw(); } }
  function lock(){ board=merge(board,current); const {board:nb,cleared}=clearLines(board); board=nb;
    if(cleared){ score+=(cleared*100)*level; lines+=cleared;
      if(!fixedSpeed){ const nl=Math.floor(lines/10)+startSpeed;
        if(nl!==level){ level=nl; clearInterval(gravTimer); gravTimer=setInterval(()=>{ if(!paused && running) softDrop(); }, levelInterval(level)); } } }
    spawn(); draw();
  }
  function softDrop(){ if(current && !collide(board,current,0,1)) current.y++; else lock(); draw(); }
  function hardDrop(){ while(current && !collide(board,current,0,1)) current.y++; lock(); }
  function loadLB(){ try{ return JSON.parse(localStorage.getItem(STORAGE_LB)||'[]'); }catch{return []} }
  function saveLB(x){ localStorage.setItem(STORAGE_LB, JSON.stringify(x)); }
  function renderLB(){ const items=loadLB().slice(0,10); lbEl.innerHTML='';
    if(items.length===0){ const li=document.createElement('li'); li.textContent='No scores yet — be the first!'; li.style.color='rgba(255,255,255,.7)'; lbEl.appendChild(li); return; }
    items.forEach((it,i)=>{ const li=document.createElement('li'); li.style.display='flex'; li.style.justifyContent='space-between'; li.style.padding='6px 0'; li.style.borderBottom='1px dashed rgba(255,255,255,.15)'; const left=document.createElement('span'); left.textContent=(i+1)+'. '+(it.name||'Player'); const right=document.createElement('span'); right.textContent=it.score; li.append(left,right); lbEl.appendChild(li); });
  }
  function saveScore(){ const name=(nameInput.value||'Player').slice(0,24);
    const items=loadLB(); items.push({name,score,date:new Date().toISOString(),duration:totalSeconds,startSpeed,fixedSpeed});
    items.sort((a,b)=>b.score-a.score); saveLB(items.slice(0,50)); renderLB(); nameModal.classList.remove('open');
  }

  document.getElementById('saveBtn').onclick=saveScore;
  document.getElementById('skipBtn').onclick=()=>nameModal.classList.remove('open');
  document.getElementById('clearLb').onclick=()=>{ saveLB([]); renderLB(); };
  startBtn.onclick=startGame; pauseBtn.onclick=pauseResume; resetBtn.onclick=resetGame;

  window.addEventListener('keydown',e=>{
    if(e.code==='Space') e.preventDefault();
    if(e.code==='KeyP'){ e.preventDefault(); return pauseResume(); }
    if(e.code==='KeyR'){ e.preventDefault(); return resetGame(); }
    if(!running || paused || !current) return;
    switch(e.code){
      case 'ArrowLeft': e.preventDefault(); tryMove(-1,0); break;
      case 'ArrowRight': e.preventDefault(); tryMove(1,0); break;
      case 'ArrowDown': e.preventDefault(); softDrop(); break;
      case 'ArrowUp': e.preventDefault(); rotatePiece(); break;
      case 'Space': e.preventDefault(); hardDrop(); break;
    }
  }, {passive:false});

  (function boot(){ board=empty(); queue=[]; current=null; score=0; lines=0; level=1; totalSeconds=120; remaining=120; startSpeed=1; fixedSpeed=false; buildBoard(); draw(); renderLB(); })();
})();
</script>
</body>
</html>
